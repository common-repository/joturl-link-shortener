(function(d){var g=wp.i18n.__;window.JotUrl={baseAjaxURL:ajaxurl,FIELDS:{INPUT:"input",TEXTAREA:"textarea",SELECT:"select",TAGS:"tags",FLAG:"flag",LINK:"link",BUTTON:"button",TITLE:"title",SUBTITLE:"subtitle",SEP1:"sep1",SEP2:"sep2",SEP3:"sep3",SEP4:"sep4",SEP5:"sep5",SPACER1:"sp1",SPACER2:"sp2",SPACER3:"sp3",SPACER4:"sp4",SPACER5:"sp5",BREAK:"break",CONTAINER:"container",SCRIPT:"script",HEADER:"header",SIDECOMMENT:"sidecomment",CHECKBOX:"checkbox"},ACTIONS:{PRIMARY:"primary",SECONDARY:"secondary"},
ROLES:{DISMISS:"dismiss"},POSITIONS:{CONTENT:"content",ACTIONS:"actions",INFO:"info"},SIZES:{AUTO:"col-auto",COL0:"col-0",COL01:"col-0-1",COL02:"col-0-2",COL03:"col-0-3",COL04:"col-0-4",COL05:"col-0-5",COL1:"col-1",COL2:"col-2",COL3:"col-3",COL4:"col-4",COL5:"col-5",COL6:"col-6",COL7:"col-7",COL8:"col-8",COL9:"col-9",COL10:"col-10"},ICONS:{JOTURL:"joturlwp_icon_joturl",PARAMS:"joturlwp_icon_params",PLUS:"joturlwp_icon_plus",MINUS:"joturlwp_icon_minus",EDIT:"joturlwp_icon_edit",INFO:"joturlwp_icon_info",
WARNING:"joturlwp_icon_warning",ERROR:"joturlwp_icon_error",REFRESH:"joturlwp_icon_refresh",CLOSE:"joturlwp_icon_close",SHORTEN:"joturlwp_icon_shorten",DELETE:"joturlwp_icon_delete",EXTERNAL:"joturlwp_icon_external",COPY:"joturlwp_icon_copy",CHECK:"joturlwp_icon_check",EYE:"joturlwp_icon_eye"},utms:{utm_source:g("Campaign source","joturl-link-shortener"),utm_medium:g("Campaign medium","joturl-link-shortener"),utm_campaign:g("Campaign name","joturl-link-shortener"),utm_term:g("Campaign term","joturl-link-shortener"),
utm_content:g("Campaign content","joturl-link-shortener")},cache:{},ajax_setup:!1,loading:!1};var a=window.JotUrl;a.init=function(){a.ajax_setup||(a.ajax_setup=1,d(document).ajaxStart(function(){a.startDialogLoading()}),d(document).ajaxStop(function(){a.stopDialogLoading()}));return a};a.setLoading=function(c){a.loading="undefined"==typeof c?!0:c};a.isLoading=function(){return a.loading};a.ajax=function(c){a.deleteDialogMessage();c.url=a.baseAjaxURL+"?"+(c.url||"");if(!d(".joturl-panel-holder").length){var e=
c.complete;c.complete=function(){a.stopGlobalLoading();"function"==typeof e&&e.apply(this,arguments)};a.startGlobalLoading()}var b=c.success;c.success=function(c){"undefined"!=typeof c.success&&!c.success&&c.data&&c.data.error?a.showDialogError(c.data.error):"function"==typeof b&&b.apply(this,arguments)};var l=c.error;c.error=function(c,b,d){var e=d||b;e&&a.showDialogError(e);"function"==typeof l&&l.apply(this,arguments)};d.ajax(c)};a.getWPAdminBarHeight=function(){var a=d("#wpadminbar");return a.is(":visible")?
a.height():0};a.closeDialog=function(){var a=d(".joturl-panel-holder").last(),e=d(window).width();d(".joturl-main-container",a).css({transform:"translate("+e+"px, 0)"});a.trigger("dialog.ju.close");setTimeout(function(){a.remove()},250)};a.resizeDialog=function(){var c=d(".joturl-panel-holder");if(c.length){var e=a.getWPAdminBarHeight(),b=d(window).width(),l=a.getDialogWidth(b),h=b-l;c.each(function(){var a=d(".joturl-main-container",this),f=d(".joturl-main-sub",this);a.css({"max-width":l+"px",transform:"translate("+
h+"px, 0)"});f.css({transform:"translate("+b+"px, 0)"});d(".joturl-panel-overlay",this).css("top",e+"px");d(".joturl-panel",this).css("top",e+"px");d(".joturl-panel-overlay",c).css("top",e+"px");a=d(".joturl-panel-footer",this);a=d(".joturl-panel-footer-actions",a);var k=0;a=d("button",a);a.each(function(){var a=d(this);a.css("min-width",0);k=Math.max(k,a.width());a.css("min-width","")});k&&a.length*k<l-250?a.css({width:k+"px","min-width":""}):a.css({width:"auto","min-width":"0"})})}};a.showDialogMessageTimeout=
null;a.deleteDialogMessage=function(){a.showDialogMessageTimeout&&clearTimeout(a.showDialogMessageTimeout);var c=d(".joturl-panel-holder").last();c=d(".joturl-panel-message-container",c);c.parent().hide();c.empty()};a.showDialogMessage=function(c,e,b){var l=d(".joturl-panel-holder").last();l&&l.length?(l=d(".joturl-panel-message-container",l),l.empty(),e&&l.append('<i class="icon '+e+'">'),e=l.parent(),l.append(d('<span class="message">').html(b)),b=d('<a href="#" class="close">'),b.html("&times;"),
b.click(function(){a.deleteDialogMessage();return!1}),l.append(b),e.addClass(c).show(),a.showDialogMessageTimeout&&clearTimeout(a.showDialogMessageTimeout),a.showDialogMessageTimeout=setTimeout(function(){a.deleteDialogMessage()},15E3)):a.alert(b)};a.showDialogError=function(c){a.showDialogMessage("ju_error","joturlwp_icon_error",c)};a.showDialogInformation=function(c){a.showDialogMessage("ju_information","joturlwp_icon_information",c)};a.showDialogWarning=function(c){a.showDialogMessage("ju_warning",
"joturlwp_icon_warning",c)};a.getDialogWidth=function(a){return Math.round(a*(500>a?.95:1E3>a?.75:.5))};a.openDialog=function(c,e){var b=a.getWPAdminBarHeight(),l=d(JotUrlTemplates.overlay);d(".title",l).html(c.toUpperCase());var h=d(".joturl-main-container",l);c=d(".joturl-main-sub",l);var g=d(window).width(),f=a.getDialogWidth(g),k=g-f;h.css({"max-width":f+"px",transform:"translate("+g+"px, 0)"});c.css({transform:"translate("+g+"px, 0)"});d(".joturl-panel-close",l).click(a.closeDialog);d(".joturl-panel",
l).css("top",b+"px");d("#wpbody-content").append(l);"function"==typeof e&&e.apply(a,[l]);setTimeout(function(){h.css({transform:"translate("+k+"px, 0)"});l.trigger("dialog.ju.open")},250);return l};a.addResult=function(a,d){for(var b=d.id,c=0;c<a.length;c++)if(a[c].id==b){a[c]=d;return}a.push(d)};a.getAttributes=function(a){var c={};a&&a.length&&a[0]&&d.each(a[0].attributes,function(){this.specified&&(c[this.name]=this.value)});return c};a.stringify=function(a){try{return JSON.stringify(a)}catch(e){}return""};
a.parse=function(a){try{return JSON.parse(a)}catch(e){}return{}};a.initSelect2=function(c){var e=d("#"+c),b=e.data("source"),l=1==e.data("memory");l&&e.change(function(){var b=d("option:selected",this).first(),e=a.getAttributes(b);e.text=b.text();d.cookie("last_sel_"+c,a.stringify(e))});if(b){e.wrap('<div class="refresh_container">');var h=d('<a class="refresh input" data-id="'+c+'" title="'+g("force refresh","joturl-link-shortener")+'"><i class="icon joturlwp_icon_refresh"></i></a>');e.addClass("with_refresh").after(h);
h.click(function(){if(!e.is(":disabled")){var b=d(this);a.initSelect2(b.data("id"));b.remove()}})}var m={width:"100%",sorter:function(a){return a.sort(function(a,b){a=a.text.toLowerCase();b=b.text.toLowerCase();return"-1"==b.id||a>b?1:"-1"==a.id||a<b?-1:0})}};e.select2(m);var f=function(){b&&(m.ajax={url:a.baseAjaxURL+"?"+b,dataType:"json",cache:!0,processResults:function(b){if(b&&b.results){var d=a.cache["select_"+c];if(d)for(var e=0;e<b.results.length;e++)a.addResult(d.results,b.results[e])}return b}},
e.select2(m).trigger("change"))};if((h=l&&d.cookie("last_sel_"+c))&&(h=a.parse(h))){l=d("<option>");for(var k in h)0>k.indexOf("select2")&&l.attr(k,h[k]);l.text(h.text);e.append(l).val(h.value).trigger("change");f()}else l&&b?a.ajax({url:b,data:{default:1},success:function(a){if(a&&a.results&&a.results.length){a=a.results[0];var b=d("<option>");b.attr("value",a.id).text(a.text).data("info",a);e.append(b).val(a.id).trigger("change");f()}},error:function(){f()}}):(e.val(d("option",e).first().attr("value")||
"").trigger("change"),f())};a.initTags=function(c){d("#"+c).tagit({autocomplete:{delay:0,minLength:2,source:a.baseAjaxURL+"?action=tags_list"}})};a.randomString=function(a){for(var c="";c.length<a;)c+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(1E6*Math.random()%62);return c};a.makeUniqueID=function(c){c||(c=15);for(var e="id_"+a.randomString(c);d("#"+e).length;)e="id_"+a.randomString(c);return e};a.createSelect2Init=function(c){c.id||(c.id=a.makeUniqueID());var e=d('<script id="script_'+
c.id+'" data-id="'+c.id+'">');e.on("custom_event",function(){JotUrl.initSelect2(d(this).data("id"))});e.html("(function($){try{var s=$('#script_"+c.id+"');s.trigger('custom_event');}catch(e){console.log(e)}})(jQuery);");return e};a.createTagsInit=function(c){c.id||(c.id=a.makeUniqueID());var e=d('<script id="script_'+c.id+'" data-id="'+c.id+'">');e.on("custom_event",function(){JotUrl.initTags(d(this).data("id"))});e.html("(function($){try{var s=$('#script_"+c.id+"');s.trigger('custom_event');}catch(e){console.log(e)}})(jQuery);");
return e};a.isBlock=function(c){return c==a.FIELDS.BREAK||c==a.FIELDS.TITLE||c==a.FIELDS.SUBTITLE||c==a.FIELDS.CONTAINER||c==a.FIELDS.HEADER||c==a.FIELDS.SPACER1||c==a.FIELDS.SPACER2||c==a.FIELDS.SPACER3||c==a.FIELDS.SPACER4||c==a.FIELDS.SPACER5};a.addToPosition=function(c,e,b,l,h){c=c||{};b=b||a.POSITIONS.CONTENT;"undefined"==typeof c[b]&&(c[b]=[]);c=c[b];var g;if(!c.length||a.isBlock(e)||(g=c[c.length-1].data("type"))&&a.isBlock(g))g=d("<div>"),g.addClass(h.container_class||"cols_container").data("type",
e),c.push(g);c[c.length-1].append(l)};a.addField=function(c,e,b){c=c||{};var l=[],h=d("<div>");h.addClass("col");h.on("container:hide",function(){h.hide()}).on("container:show",function(){h.show()});b=b||{};b.label&&(b.label=b.label.replace(/\n/g,"<br>"));if(e==a.FIELDS.HEADER){var m=a.POSITIONS.CONTENT;delete b.position;h.addClass(b.size||"col-10");delete b.size;var f=d("<div>");var k=d("<span>");k.addClass("label");b.label?k.html(b.label):k.addClass("&nbsp;").html("&nbsp;");f.addClass("header").html("<hr>").append(k);
delete b.label;delete b.id}else if(e==a.FIELDS.CONTAINER){m=a.POSITIONS.CONTENT;delete b.position;h.addClass(b.size||"col-10");delete b.size;delete b.label;f=d("<div>");if(b.events){for(var q in b.events)h.bind(q,b.events[q]);delete b.events}"undefined"==typeof b.visible||b.visible||(h.hide(),delete b.visible);h.attr("id",b.id||a.makeUniqueID());delete b.id;var n=h}else if(e==a.FIELDS.TITLE||e==a.FIELDS.SUBTITLE)m=a.POSITIONS.CONTENT,delete b.position,h.addClass(b.size||"col-10"),delete b.size,f=
d("<p>"),f.addClass(e==a.FIELDS.TITLE?"title":"subtitle"),b.label?f.html(b.label):f.addClass("empty").html("&nbsp;"),h.append(f),delete b.label;else if(e==a.FIELDS.SIDECOMMENT)m=a.POSITIONS.CONTENT,delete b.position,h.addClass(b.size||"col-10"),delete b.size,f=d("<p>"),f.addClass("sidecomment"),b.label?f.html(b.label):f.addClass("empty").html("&nbsp;"),"undefined"==typeof b.compact||b.compact||f.removeClass("empty"),delete b.compact,h.append(f),delete b.label;else{m=b.position;delete b.position;b.id&&
!b.name?b.name=b.id:b.name&&!b.id&&(b.id=b.name);e!=a.FIELDS.BREAK&&b.size&&(h.addClass(b.size),delete b.size);if(e==a.FIELDS.LINK||e==a.FIELDS.BUTTON||e==a.ACTIONS.PRIMARY||e==a.ACTIONS.SECONDARY)b.text=b.label,delete b.label;k=d("<p>");k.addClass("label");b.label?k.html('<span class="text">'+b.label+"</span>"+(b.mandatory?' <span class="mandatory" title="'+g("this field is mandatory","joturl-link-shortener")+'">*</span>':"")):k.addClass("empty").html("&nbsp;");delete b.label;delete b.mandatory;
h.append(k);switch(e){case a.FIELDS.INPUT:f=d("<input>");f.attr("type","text").addClass("input");h.on("readonly:true",function(){f.prop("readonly",!0)}).on("readonly:false",function(){f.prop("readonly",!1)}).on("input:value",function(a,b){f.val(b)});break;case a.FIELDS.TEXTAREA:f=d("<textarea>");f.addClass("input");break;case a.FIELDS.SELECT:f=d("<select>");f.addClass("input");"undefined"==typeof b.memory&&(b.memory=1);f.attr("data-memory",b.memory?1:0);delete b.memory;if(b.options){for(k=0;k<b.options.length;k++){var p=
b.options[k];p.value=p.value||p.id||"";p.text=p.text||p.name||"";f.append('<option value="'+p.value.replace(/"/g,"")+'">'+p.text.replace(/</g,"").replace(/>/g,"")+"</option>").trigger("change");d("option:selected",f).length||f.val(p.value).trigger(change)}delete b.options}b.source&&(f.data("source",b.source),delete b.source);l.push(a.createSelect2Init(b));break;case a.FIELDS.CHECKBOX:n=d("p",h).html();h.empty();p=b.id||a.makeUniqueID();f=d('<div class="flag">');var r=d("<div>");r.addClass("flag-container");
k=d('<input type="checkbox">');k.attr("id",p).prop("checked",b.default||0);r.append(k);r.append('<span class="flag-switch"></span><span class="flag-toggle"></span>');f.append(r);var u=d("<label>");u.attr("for",p).html(n);f.append(u);r.click(function(){u.trigger("click")});n=k;k.on("title:update",function(a,b){h.attr("title",b)});delete b.id;break;case a.FIELDS.TAGS:f=d("<ul>");f.addClass("input");if(b.tags){for(k=0;k<b.tags.length;k++)p=d("<li>"),p.html(b.tags[k]),f.append(p);delete b.tags}l.push(a.createTagsInit(b));
break;case a.FIELDS.BUTTON:case a.FIELDS.LINK:f=e==a.FIELDS.BUTTON?d('<button class="generic">'):d("<a>");f.addClass("input");"undefined"==typeof b.compact||b.compact||k.removeClass("empty");delete b.compact;b.external&&(f.addClass("external"),delete b.external);if(b.icon){var t=d("<span>");t.addClass("icon "+b.icon);f.on("icon:change",function(a,b){b&&t.removeClass(function(a,b){return(b.match(/(^|\s)joturlwp_icon_\S+/g)||[]).join(" ")}).addClass(b)}).append(t);delete b.icon}b.disabled&&(f.addClass("disabled"),
delete b.disabled);f.on("disabled:true enabled:false",function(){d(this).addClass("disabled")}).on("disabled:false enabled:true",function(){d(this).removeClass("disabled")});var v=d("<span>");v.html(b.text||"");f.append(v).on("label:append",function(a,b){d(".append",v).remove();b&&v.append(d('<span class="append">').html(b))}).on("label:replace",function(a,b){v.empty().html(b||"&nbsp;")});delete b.text;break;case a.ACTIONS.PRIMARY:case a.ACTIONS.SECONDARY:m||(m=a.POSITIONS.ACTIONS);f=d("<button>");
f.addClass("input "+(e==a.ACTIONS.PRIMARY?"primary":"secondary")).html(b.text);b.role&&(b.role==a.ROLES.DISMISS&&f.click(a.closeDialog),delete b.role);break;case a.FIELDS.SEP5:case a.FIELDS.SEP4:case a.FIELDS.SEP3:case a.FIELDS.SEP2:case a.FIELDS.SEP1:k.empty().addClass("empty");h.removeAttr("class").addClass("col col-0-"+e.substr(-1));f=d("<span>");f.html("&nbsp;");break;case a.FIELDS.SPACER5:case a.FIELDS.SPACER4:case a.FIELDS.SPACER3:case a.FIELDS.SPACER2:case a.FIELDS.SPACER1:k.empty().addClass("empty");
h.removeAttr("class").addClass("row row-0-"+e.substr(-1));f=d("<span>");f.html("&nbsp;");break;case a.FIELDS.BREAK:h.css({clear:"both",width:0,height:0}),f=d("<span>"),f.html("&nbsp;")}}if(f){b.disabled&&(f.prop("disabled",!0),delete b.disabled);b.readonly&&(f.prop("readonly",!0),delete b.readonly);if(b.events){for(q in b.events)f.bind(q,b.events[q]);delete b.events}b.class&&(f.addClass(b.class),delete b.class);if(b.data){for(var w in b.data)f.attr("data-"+w,b.data[w]);delete b.data}for(var x in b)f.attr(x,
b[x]),"value"===x&&f.val(b[x]);h.append(f);a.addToPosition(c,e,m,h,b)}if(l.length)for(k=0;k<l.length;k++)a.addToPosition(c,a.FIELDS.SCRIPT,a.POSITIONS.CONTENT,l[k],b);return n?n:f?f:h};a.isAction=function(c){return c==a.POSITIONS.ACTIONS};a.isInfo=function(c){return c==a.POSITIONS.INFO};a.isDialog=function(a){return a&&a.length&&a.hasClass("joturl-panel-holder")};a.renderInputs=function(c,e){var b=a.isDialog(c),l=e.events||{};delete e.events;var h=b?d(".joturl-panel-footer",c):c;h=b?d(".joturl-panel-footer-actions",
h):c;var g=b?d(".joturl-panel-footer>.joturl-panel-footer-info",c):c,f=b?d(".joturl-panel-content",c):c,k;for(k in e)if(b&&a.isAction(k))for(c=0;c<e[k].length;c++)h.append(d("button",e[k][c]));else if(b&&a.isInfo(k))for(c=0;c<e[k].length;c++)g.append(d(">*",e[k][c]));else f.append(e[k]);b&&a.resizeDialog();if("undefined"!=typeof l["render:after"])for(e=l["render:after"],c=0;c<e.length;c++)b=e[c],"function"==typeof b&&b.apply(this)};a.startGlobalLoading=function(){d("#joturl_global_loading").remove();
d("body").append('<div id="joturl_global_loading">')};a.stopGlobalLoading=function(){d("#joturl_global_loading").remove()};a.startDialogLoading=function(){var a=d(".joturl-panel-holder").last();a&&a.length&&(d(".joturl-panel",a).addClass("loading"),d(".joturl-panel-footer-actions button",a).prop("disabled",!0))};a.stopDialogLoading=function(){var a=d(".joturl-panel-holder").last();a&&a.length&&(d(".joturl-panel",a).removeClass("loading"),d(".joturl-panel-footer-actions button",a).prop("disabled",
!1))};a.removeErrors=function(a){d(".error",a).removeClass("error")};a.addError=function(c,d){c.addClass("error");a.showDialogError(d)};a.openParametersEditorDialog=function(c,e,b){var l=!!b.id,h=b.query||{},m=h.params;a.openDialog(e,function(e){var f={},q={};a.addField(f,a.FIELDS.TITLE,{label:g("UTM parameters","joturl-link-shortener")});a.addField(f,a.FIELDS.SUBTITLE,{label:g("Here you can easily add campaign parameters to URLs to track custom campaigns in Google Analytics","joturl-link-shortener")});
var n=a.addField(f,a.FIELDS.SELECT,{id:"tracking_link_utm_template_id",source:"action=utm_templates_list",size:a.SIZES.COL4,label:g("UTM template","joturl-link-shortener"),memory:l||h.utm_template_id?0:1,options:h.utm_template_id?[{value:h.utm_template_id,text:h.utm_template_name}]:null,data:{export:"utm_template_id"},events:{change:function(){var b=n.val();b&&"-"!=b.substr(0,1)?(p.trigger("container:hide"),a.ajax({data:{action:"utm_template_info",id:b},success:function(b){if(b)for(var c in a.utms)"undefined"!=
typeof b[c]&&q[c].trigger("input:value",[b[c]])}})):p.trigger("container:show")}}});a.addField(f,a.FIELDS.SEP1);a.addField(f,a.FIELDS.LINK,{id:"tracking_link_add_utm_template",compact:!1,icon:a.ICONS.PLUS,size:a.SIZES.AUTO,label:g("create a new UTM template","joturl-link-shortener"),events:{click:function(){a.openUTMTemplateCreationDialog(g("New UTM template","joturl-link-shortener"),n)}}});a.addField(f,a.FIELDS.BREAK);var p=a.addField(f,a.FIELDS.CONTAINER,{id:"tracking_link_utm_parameters_container"}),
r=0,u={},t;for(t in a.utms){var v="ju_params_"+t;q[t]=a.addField(u,a.FIELDS.INPUT,{class:"utm_value",id:v,placeholder:t,value:h[t]||"",size:a.SIZES.COL3,data:{utm:t},label:a.utms[t]+" ("+t+")"});a.addField(u,a.FIELDS.SEP1);a.addField(u,a.FIELDS.LINK,{compact:!1,icon:a.ICONS.DELETE,size:a.SIZES.COL1,events:{click:function(){var a=d(this);d("#"+a.data("id")).val("")}},data:{id:v}});r++;0==r%2?a.addField(u,a.FIELDS.BREAK):a.addField(u,a.FIELDS.SEP1)}a.renderInputs(p,u);a.addField(f,a.FIELDS.SPACER5);
a.addField(f,a.FIELDS.TITLE,{label:g("Other parameters of the destination URL","joturl-link-shortener")});a.addField(f,a.FIELDS.SUBTITLE,{label:g("Here you can specify parameters (pairs key=value) to be passed to your destination URL","joturl-link-shortener")});var w=a.addField(f,a.FIELDS.CONTAINER,{id:"tracking_link_parameter_container",events:{change:function(){var a=d(this),b=1;d(".param_key,.param_value",a).each(function(){var a=d(this),c=a.data("template"),e=a.closest(".col");d("p.label",e).html(c.replace(/#n#/,
b));a.hasClass("param_value")&&b++})}}}),x=function(b,c){b=b||"";c=c||"";var e=d("<div>");e.addClass("parameter_container");var f={};var h=g("Parameter #n# name","joturl-link-shortener");a.addField(f,a.FIELDS.INPUT,{class:"param_key",id:a.makeUniqueID(),size:a.SIZES.COL4,label:h,data:{template:h},value:b});a.addField(f,a.FIELDS.SEP1);h=g("Parameter #n# value","joturl-link-shortener");a.addField(f,a.FIELDS.INPUT,{class:"param_value",id:a.makeUniqueID(),size:a.SIZES.COL4,label:h,data:{template:h},value:c});
a.addField(f,a.FIELDS.SEP2);a.addField(f,a.FIELDS.LINK,{icon:a.ICONS.DELETE,size:a.SIZES.AUTO,events:{click:function(){d(this).closest(".parameter_container").remove();w.trigger("change")}}});a.renderInputs(e,f);w.append(e);w.trigger("change")};a.addField(f,a.FIELDS.LINK,{id:"tracking_link_add_parameter",icon:a.ICONS.PLUS,size:a.SIZES.AUTO,label:g("Add parameter","joturl-link-shortener"),events:{click:function(){x()}}});var y=a.addField(f,a.ACTIONS.SECONDARY,{role:a.ROLES.DISMISS,id:"ju_cancel_parameters",
label:g("Cancel","joturl-link-shortener")});a.addField(f,a.ACTIONS.PRIMARY,{id:"ju_create_parameters",label:g("Save","joturl-link-shortener"),events:{click:function(){var c=!1,f={utm_template_id:n.val(),utm_template_name:d("option:selected",n).text(),params:[]};a.removeErrors(e);d(".param_key",w).each(function(){var b=d(this).closest(".parameter_container"),e=d(".param_key",b).val(),h=d(".param_value",b).val();e?f.params.push({key:e,value:h}):h&&(a.addError(d(".param_key",b),g("Please enter missing key(s)",
"joturl-link-shortener")),c=!0)});c||(d(".utm_value",e).each(function(){var a=d(this),b=a.data("utm");a=a.val();b&&a&&(f[b]=a)}),b.query=f,y.trigger("click"))}}});a.renderInputs(e,f);if(m&&m.length)for(f=0;f<m.length;f++)r=m[f],x(r.key,r.value);else a.ajax({data:{action:"parse_url",u:c},success:function(b){if(b&&b.params){b=b.params;var c,e;for(e in a.utms)"undefined"!=typeof b[e]&&((c=b[e])&&d("#ju_params_"+e).val(c),delete b[e]);for(e in b)x(e,b[e])}}})})};a.openUTMTemplateCreationDialog=function(c,
e){a.openDialog(c,function(b){var c={},h={},m={},f=a.addField(c,a.FIELDS.CONTAINER,{id:"utm_template_container"}),k=a.addField(m,a.FIELDS.INPUT,{size:a.SIZES.COL8,label:g("UTM template name","joturl-link-shortener")});a.addField(m,a.FIELDS.BREAK);var q=0,n;for(n in a.utms){var p="ju_template_"+n;h[n]=a.addField(m,a.FIELDS.INPUT,{class:"utm_value",id:p,placeholder:n,mandatory:"utm_source"==n,size:a.SIZES.COL3,data:{utm:n},label:a.utms[n]+" ("+n+")"});a.addField(m,a.FIELDS.SEP1);a.addField(m,a.FIELDS.LINK,
{compact:!1,icon:a.ICONS.DELETE,size:a.SIZES.COL1,events:{click:function(){var a=d(this);d("#"+a.data("id")).val("")}},data:{id:p}});q++;0==q%2?a.addField(m,a.FIELDS.BREAK):a.addField(m,a.FIELDS.SEP1)}a.renderInputs(f,m);var r=a.addField(c,a.ACTIONS.SECONDARY,{role:a.ROLES.DISMISS,id:"ju_cancel_utm_template",label:g("Cancel","joturl-link-shortener")});a.addField(c,a.ACTIONS.PRIMARY,{id:"ju_create_utm_template",label:g("Create","joturl-link-shortener"),events:{click:function(){var c={name:k.val()},
f;for(f in a.utms)c[f]=h[f].val();a.removeErrors(b);c.name&&c.utm_source?(c.action="create_utm_template",a.ajax({data:c,success:function(a){if(a&&a.id&&a.name){var b=d("<option>");b.attr("value",a.id).text(a.name);e.append(b).val(a.id).trigger("change");r.trigger("click")}}})):c.name?c.utm_source||a.addError(h.utm_source,g("The parameter utm_source is mandatory","joturl-link-shortener")):a.addError(k,g("Please enter a valid UTM template name","joturl-link-shortener"))}}});a.renderInputs(b,c)})};a.openNewProjectDialog=
function(c,e){a.openDialog(c,function(b){var c={},h=a.addField(c,a.FIELDS.INPUT,{id:"ju_project_name",size:a.SIZES.COL4,label:g("Project name","joturl-link-shortener"),mandatory:!0});a.addField(c,a.FIELDS.BREAK);var m=a.addField(c,a.FIELDS.INPUT,{id:"ju_project_notes",size:a.SIZES.COL5,label:g("Project notes","joturl-link-shortener")}),f=a.addField(c,a.ACTIONS.SECONDARY,{role:a.ROLES.DISMISS,id:"ju_cancel_create_project",label:g("Cancel","joturl-link-shortener")});a.addField(c,a.ACTIONS.PRIMARY,{id:"ju_create_project",
label:g("Create project","joturl-link-shortener"),events:{click:function(){a.removeErrors(b);var c=d.trim(h.val());if(c){var l=d.trim(m.val());a.ajax({data:{action:"create_project",name:c,notes:l},success:function(a){if(a&&a.id&&a.name){var b=d("<option>");b.attr("value",a.id).text(a.name);e.append(b).val(a.id).trigger("change");f.trigger("click")}}})}else a.addError(h,g("Please enter a valid project name","joturl-link-shortener"))}}});a.renderInputs(b,c)})};a.addGroupItem=function(c,e,b,l,h){a.addField(e,
a.FIELDS.LINK,{class:"group_item tracking_link_"+c,size:a.SIZES.AUTO,data:{id:b,export:c,name:l},label:" | "+l,icon:a.ICONS.DELETE,events:{click:function(){d(this).closest(".cols_container").remove();"function"==typeof h&&h.apply(this,[])}},title:g("click to remove")})};a.addSelectionGroup=function(c,e){var b=a.addField(c,a.FIELDS.LINK,{class:"group_collapse",id:"tracking_link_add_"+e.name,icon:a.ICONS.PLUS,size:a.SIZES.AUTO,label:e.add_label,events:{"custom:expand":function(){g.trigger("container:show");
d(this).trigger("icon:change",[a.ICONS.MINUS])},"custom:collapse":function(){g.trigger("container:hide");d(this).trigger("icon:change",[a.ICONS.PLUS])},"custom:count_items":function(){var a=d(".group_item",n).length;d(this).trigger("label:append",[a?"("+a+")":""])},click:function(){var a=d(this);d(".group_collapse",b.closest(".joturl-panel-scrollpane")).not(a).trigger("custom:collapse");g.is(":visible")?a.trigger("custom:collapse"):a.trigger("custom:expand")}}}),g=a.addField(c,a.FIELDS.CONTAINER,
{visible:!1}),h={},m=function(c,d){var h={};a.addGroupItem(e.name,h,c,d,function(){f.val("-1").trigger("change");n.trigger("item_list_changed");b.trigger("custom:count_items")});a.renderInputs(n,h);f.val("-1").trigger("change");n.trigger("item_list_changed");b.trigger("custom:count_items")},f=a.addField(h,a.FIELDS.SELECT,{container_class:"rows_container",memory:!1,id:"tracking_link_"+e.name,source:e.ajax_url,size:a.SIZES.COL3,label:e.main_label,options:[{value:"-1",text:"# "+e.default_option}],events:{change:function(){var a=
f.val();if(a&&"-1"!=a&&(e.replace_items&&n.empty(),!d('[data-id="'+a+'"]',n).length&&d(".cols_container",n).length<e.max_items)){var b=d("option:selected",f).text();b&&m(a,b)}}}});a.addField(h,a.FIELDS.SEP1);a.addField(h,a.FIELDS.SIDECOMMENT,{container_class:"rows_container",size:a.SIZES.COL6,label:e.subtitle});var k={container_class:"rows_container"};e.container_events&&(k.events=e.container_events);a.addField(h,a.FIELDS.SPACER1,{container_class:"rows_container"});var q=e.items||[];q&&d.isArray(q)&&
(k.events=k.events||{},k.events["update:items"]=function(){for(var a=0;a<q.length;a++){var b=q[a];m(b.id,b.text||b.name)}});var n=a.addField(h,a.FIELDS.CONTAINER,k);a.renderInputs(g,h);h={id:f,add:b,container:n,subcontainer:g};c.events=c.events||{};c.events["render:after"]=c.events["render:after"]||[];c.events["render:after"].push(function(){n.trigger("update:items")});return h};a.updateSelectionGroups=function(a){var c;if(a&&d.isArray(a)&&(c=a.length))for(var b=0;b<c;b++)a[b].container.trigger("update:items")};
a.copyToClipboard=function(a){try{var c=document.createElement("textarea");c.setAttribute("style","position:absolute;top:-1000px;left:-1000px");document.body.appendChild(c);c.value=a;c.focus();c.select();document.execCommand("Copy");c.remove()}catch(b){console.log(b)}};a.isFirefox=function(){try{return-1<navigator.userAgent.toLowerCase().indexOf("firefox")}catch(c){}return!1};a.openShortenDialog=function(c,e,b,l){b=b||{};var h=!!b.id;return a.openDialog(e,function(e){var f={};a.addField(f,a.FIELDS.TEXTAREA,
{readonly:!0,title:c,size:a.SIZES.COL8,id:"tracking_link_destination_url",label:g("Destination URL","joturl-link-shortener"),value:c||b.long_url||"",mandatory:!0,data:{export:"long_url"}});a.addField(f,a.FIELDS.SEP1);a.addField(f,a.FIELDS.LINK,{id:"tracking_link_modify_params",compact:!1,icon:a.ICONS.PARAMS,size:a.SIZES.AUTO,label:g("modify url parameters","joturl-link-shortener"),events:{click:function(){a.openParametersEditorDialog(d("#tracking_link_destination_url").val(),g("Edit UTM &amp; URL parameters",
"joturl-link-shortener"),b)}}});a.addField(f,a.FIELDS.BREAK);h||(a.addField(f,a.FIELDS.SELECT,{id:"tracking_link_domain_id",source:"action=domains_list",size:a.SIZES.COL3,label:g("Domain","joturl-link-shortener"),mandatory:!0,data:{export:"domain_id"}}),a.addField(f,a.FIELDS.SEP1),a.addField(f,a.FIELDS.INPUT,{size:a.SIZES.COL3,id:"tracking_link_alias",value:a.randomString(6).toLowerCase(),label:g("Alias","joturl-link-shortener"),mandatory:!0,data:{export:"alias"}}),a.addField(f,a.FIELDS.BREAK));a.addField(f,
a.FIELDS.TAGS,{id:"tracking_link_tags",size:a.SIZES.COL4,label:g("Tags","joturl-link-shortener"),tags:b.tags||[],data:{export:"tags"}});a.addField(f,a.FIELDS.SEP1);a.addField(f,a.FIELDS.INPUT,{size:a.SIZES.COL4,id:"tracking_link_notes",label:g("Notes","joturl-link-shortener"),value:b.notes||"",data:{export:"notes"}});a.addField(f,a.FIELDS.BREAK);var k=a.addField(f,a.FIELDS.SELECT,{id:"tracking_link_project_id",source:"action=projects_list",size:a.SIZES.COL4,label:g("Project","joturl-link-shortener"),
memory:h?0:1,options:h?[{value:b.project_id,text:b.project_name}]:null,mandatory:!0,data:{export:"project_id"}});a.addField(f,a.FIELDS.SEP1);a.addField(f,a.FIELDS.LINK,{id:"tracking_link_add_project",compact:!1,icon:a.ICONS.PLUS,size:a.SIZES.AUTO,label:g("create a new project","joturl-link-shortener"),events:{click:function(){a.openNewProjectDialog(g("Create new project","joturl-link-shortener"),k)}}});a.addField(f,a.FIELDS.BREAK);a.addField(f,a.FIELDS.SPACER2);a.addField(f,a.FIELDS.HEADER,{label:g("options",
"joturl-link-shortener")});a.addField(f,a.FIELDS.SPACER2);a.addSelectionGroup(f,{ajax_url:"action=conversions_list",items:b.conversion,max_items:5,name:"conversion",main_label:g("Conversion codes","joturl-link-shortener"),add_label:g("add conversion codes","joturl-link-shortener"),create_label:g("create a new conversion code","joturl-link-shortener"),create_link:"https://www.joturl.com/reserved/conversions.html",default_option:g("no conversion","joturl-link-shortener"),subtitle:g("Select a conversion code from the list to add it to the tracking link, you can add up to 5 distinct conversions codes.",
"joturl-link-shortener")});a.addField(f,a.FIELDS.SPACER1);var m=g("Remarketing pixels and calls to action can not be added at the same time.","joturl-link-shortener")+'&emsp;<a href="https://joturl.zendesk.com/hc/en-us/articles/360026864912" target="_blank"><i class="joturlwp_icon_external"></i>&nbsp;'+g("details","joturl-link-shortener")+"</a>",n=a.addSelectionGroup(f,{ajax_url:"action=remarketings_list",items:b.remarketing,max_items:5,name:"remarketing",main_label:g("Remarketing pixel","joturl-link-shortener"),
add_label:g("add remarketing pixel","joturl-link-shortener"),create_label:g("create a new remarketing pixel","joturl-link-shortener"),create_link:"https://www.joturl.com/reserved/remarketings.html",default_option:g("no remarketing pixel","joturl-link-shortener"),subtitle:g("Select a remarketing pixel from the list to add it to the tracking link, you can add up to 5 distinct remarketing pixels.","joturl-link-shortener")+" "+m,container_events:{item_list_changed:function(){d(".tracking_link_remarketing",
r).length?u.val("-1").trigger("change").prop("disabled",!0):u.trigger("change").prop("disabled",!1)}}}),p=n.id,r=n.container;a.addField(f,a.FIELDS.SPACER1);m=a.addSelectionGroup(f,{ajax_url:"action=ctas_list",items:b.cta?[b.cta]:null,replace_items:!0,max_items:1,name:"cta",main_label:g("Call to action","joturl-link-shortener"),add_label:g("add call to action","joturl-link-shortener"),create_label:g("create a new call to action","joturl-link-shortener"),create_link:"https://www.joturl.com/reserved/ctas.html",
default_option:g("no call to action","joturl-link-shortener"),subtitle:g("Select a call to action to add it to the tracking link.","joturl-link-shortener")+" "+m,container_events:{item_list_changed:function(){d(".tracking_link_cta",t).length?p.val("-1").trigger("change").prop("disabled",!0):p.trigger("change").prop("disabled",!1)}}});var u=m.id,t=m.container,v=a.addField(f,a.FIELDS.CHECKBOX,{id:"tracking_link_copy_to_clickboard",default:"1",size:a.SIZES.COL3,label:g("Copy to clipboard","joturl-link-shortener"),
position:a.POSITIONS.INFO});a.isFirefox()&&v.prop("checked",!1).prop("disabled",!0).trigger("title:update",[g("This option cannot be enabled on Firefox","joturl-link-shortener")]);var w=a.addField(f,a.ACTIONS.SECONDARY,{role:a.ROLES.DISMISS,id:"ju_cancel_create_tl",label:g("Cancel","joturl-link-shortener")});a.addField(f,a.ACTIONS.PRIMARY,{id:"ju_create_tl",label:h?g("Save","joturl-link-shortener"):g("Create","joturl-link-shortener"),events:{click:function(){var c={};d("[data-export]",e).each(function(){var a=
d(this),b=a.data("export");if(a.is("input")||a.is("textarea"))var e=d.trim(a.val());else a.is("ul")&&a.hasClass("tagit")?e=a.tagit("assignedTags"):a.is("select")?(e=d.trim(a.val()),"-1"==e&&(e="")):a.is("a")&&(e=c[b]||[],e.push(d.trim(a.data("id"))));e&&(c[b]=e)});c.conversion&&(c.conversion=c.conversion.join(","));c.remarketing&&(c.remarketing=c.remarketing.join(","));c.cta&&(c.cta=c.cta.join(","));h?(c.action="edit_tl",c.id=b.id):c.action="create_tl";c.query=b.query||{};a.ajax({data:c,success:function(b){v&&
v.is(":checked")&&b&&b.short_url&&a.copyToClipboard(b.short_url);"function"==typeof l?l.apply(this,[b]):w.trigger("click")}})}}});a.renderInputs(e,f)})};a.alert=function(c,e){e||(e={},e[g("Ok","joturl-link-shortener")]=function(){d(this).dialog("close")});var b=d("<div>"),l=d('<p style="display:flex;align-items: center">');l.append(d('<span class="joturl-icon" style="margin-right:1em">').addClass(a.ICONS.INFO)).append(d("<span>").html(c));b.append(l).dialog({resizable:!1,height:"auto",width:400,modal:!0,
buttons:e})};a.confirm=function(c,e,b){var g=d("<div>");g.attr("title",e);e=d('<p style="display:flex;align-items: center">');e.append(d('<span class="joturl-icon" style="margin-right:1em">').addClass(a.ICONS.WARNING)).append(d("<span>").html(c));g.append(e).dialog({resizable:!1,height:"auto",width:400,modal:!0,buttons:b})};a.confirmDelete=function(c,e){var b={};b[g("Delete","joturl-link-shortener")]=function(){d(this).dialog("close");e(!0)};b[g("Cancel","joturl-link-shortener")]=function(){d(this).dialog("close");
e(!1)};a.confirm(c,g("Confirm deletion","joturl-link-shortener"),b)};a.bindEvents=function(){d(window).resize(a.resizeDialog);d(".joturl-shorten-link").not(".b").each(function(){var c=d(this);c.addClass("b").unbind("click.joturl");var e=c.data("url");e&&c.bind("click.joturl",function(){a.openShortenDialog(e,c.attr("title"),null,function(b){if(b){var d=b.error;delete b.error;a.ajax({data:{action:"setpostinfo",pid:c.data("pid"),info:a.stringify(b)},success:function(b){b&&b.html&&(c.closest("td").empty().html(b.html),
a.closeDialog(),a.bindEvents(),d&&a.alert(g("The tracking link has been created, however the system has returned the following error","joturl-link-shortener")+"\n\n"+d))}})}})})});d(".joturl-edit-link").not(".b").each(function(){var c=d(this);c.addClass("b").unbind("click.joturl");var e=c.data("pid");e&&c.bind("click.joturl",function(){a.isLoading()||(a.setLoading(),a.ajax({data:{action:"info_tl",pid:e},complete:function(){a.setLoading(!1)},success:function(b){b&&b.id&&b.long_url?a.openShortenDialog(null,
c.attr("title"),b,function(b){if(b){var d=b.error;delete b.error;a.ajax({data:{action:"setpostinfo",pid:c.data("pid"),info:a.stringify(b)},success:function(b){b&&b.html&&(c.closest("td").empty().html(b.html),a.closeDialog(),a.bindEvents(),d&&a.alert(g("The tracking link has been created, however the system has returned the following error","joturl-link-shortener")+"\n\n"+d))}})}}):a.alert(g("The tracking link no longer exists","joturl-link-shortener"))}}))})});d(".joturl-copy-link").not(".b").each(function(){var c=
d(this);c.addClass("b").unbind("click.joturl");c.data("url")&&c.bind("click.joturl",function(){var c=d(this),b=d(".joturl-icon",c);b.removeClass(a.ICONS.COPY).addClass(a.ICONS.CHECK);a.copyToClipboard(c.data("url"));setTimeout(function(){b.removeClass(a.ICONS.CHECK).addClass(a.ICONS.COPY)},800)})});d(".joturl-delete-link").not(".b").each(function(){var c=d(this);c.addClass("b").unbind("click.joturl");var e=c.data("pid"),b=c.data("id");e&&b&&c.bind("click.joturl",function(){a.confirmDelete(g("Are you sure you want to delete the associate tracking link?",
"joturl-link-shortener"),function(d){d&&a.ajax({data:{action:"delete_tl",id:b,pid:e},success:function(b){b&&b.html&&(c.closest("td").empty().html(b.html),a.bindEvents())}})})})});return a};a.init().bindEvents()})(jQuery);
